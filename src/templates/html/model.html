{% extends 'main.html' %}

{% block maincontent %}

<main class="app-main">
  <!--begin::App Content Header-->
  <div class="app-content-header">
    <!--begin::Container-->
    <div class="container-fluid">
      <!--begin::Row-->
      <div class="row">
        <div class="col-sm-6 col-md-6">
          <h3 class="mb-0">Registered Models</h3>
        </div>
        <div class="col-sm-6 col-md-6">
          <ol class="breadcrumb float-sm-end">
            <!-- <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active" aria-current="page">Registered servers</li> -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createModelModal" onclick="document.getElementById('createModelForm').reset();">Create Model</button>
          </ol>
        </div>
      </div>
      <!--end::Row-->
    </div>
    <!--end::Container-->
  </div>
  <!--end::App Content Header-->
  <!--begin::App Content-->
  <div class="app-content">
    <!--begin::Container-->
    <div class="container-fluid">
      <!--begin::Row-->
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead class="table-light">
            <tr>
              <th style="width: 5%;">#</th>
              <th style="width: 15%;">Name</th>
              <th style="width: 10%;">Type</th>
              <th style="width: 10%;">Instances</th>
              <th style="width: 15%;">Deploy Algorithm</th>
              <th style="width: 15%;">Routing Algorithm</th>
              <th style="width: 10%;">Status</th>
              <th style="width: 10%;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for model in models %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>
                <strong>{{ model.name }}</strong>
              </td>
              <td>
                <span class="badge 
                  {% if model.type == 'GPU' %}bg-primary
                  {% else %}bg-info{% endif %}">
                  {{ model.type }}
                </span>
              </td>
              <td>
                {{ model.instance_num }}
              </td>
              <td>
                {% if model.deploy_algorithm %}
                  <span class="badge bg-info" value="{{ model.deploy_algorithm }}">
                    {{ model.get_deploy_algorithm_display }}
                  </span>
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td>
                {% if model.routing_algorithm %}
                  <span class="badge bg-info" value="{{ model.routing_algorithm }}">
                    {{ model.get_routing_algorithm_display }}
                  </span>
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td>
                <span class="badge 
                  {% if model.status == 'DRAFT' %}bg-warning
                  {% elif model.status == 'ARCHIVED' %}bg-secondary
                  {% else %}bg-success{% endif %}">
                  {{ model.status }}
                </span>
              </td>
              <td>
                <div class="btn-group" role="group">
                  <button type="button" class="btn btn-sm btn-warning btn-update-model mr-1" modelId="{{ model.id }}" title="Update">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button type="button" class="btn btn-sm btn-danger btn-delete-model" modelId="{{ model.id }}" title="Delete">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="9" class="text-center text-muted">No models registered.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <!--end::Row-->
    </div>
    <!--end::Container-->
  </div>
  <!--end::App Content-->

  <div class="modal fade" id="createModelModal" tabindex="-1" role="dialog" aria-labelledby="createModelModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createModelModalLabel">Register New Model</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
          <form method="post" id="createModelForm" action="/orchestrator/model/">
            {% csrf_token %}
            <div class="modal-body">
              <div class="mb-3" hidden>
                <label for="id" class="form-label">ID</label>
                <input type="text" class="form-control" id="id" name="id">
              </div>
              <div class="mb-3">
                <label for="id_name" class="form-label">Name</label>
                <input type="text" class="form-control" id="id_name" name="name" required>
              </div>
              <div class="mb-3">
                <label for="id_type" class="form-label">Type</label>
                <select class="form-select" id="id_type" name="type" required>
                  <option value="GPU">GPU</option>
                  <option value="CPU">CPU</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="id_description" class="form-label">Description</label>
                <textarea class="form-control" id="id_description" name="description" rows="2"></textarea>
              </div>
              <!-- <div class="mb-3">
                <label for="id_config" class="form-label">Config</label>
                <textarea class="form-control" id="id_config" name="config" rows="2"></textarea>
              </div> -->
              <div class="mb-3">
                <label for="id_deploy_algorithm" class="form-label">Deploy Algorithm</label>
                <select class="form-select" id="id_deploy_algorithm" name="deploy_algorithm" required>
                  <option value="BEST_FIT" disabled>Best fit (Not supported yet)</option>
                  <option value="LEAST_LOADED">Least Loaded</option>
                  <option value="BIGGEST_FREE_MEMORY">Biggest Free Memory</option>
                  <!-- Add more algorithms as needed -->
                </select>
              </div>
              <div class="mb-3">
                <label for="id_routing_algorithm" class="form-label">Routing Algorithm</label>
                <select class="form-select" id="id_routing_algorithm" name="routing_algorithm" required>
                  <option value="ROUND_ROBIN">Round Robin</option>
                  <option value="LEAST_SERVING">Least Serving</option>
                  <option value="RANDOM">Random</option>
                  <option value="WEIGHTED_ROUND_ROBIN" disabled>Weighted Round Robin (Not supported yet)</option>
                  <!-- Add more algorithms as needed -->
                </select>
              </div>
              <div class="mb-3">
                <label for="id_instance_num" class="form-label">Instance Number</label>
                <input type="number" class="form-control" id="id_instance_num" name="instance_num" min="1" value="1" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="saveModelBtn">Save</button>
            </div>
          </form>
        </div>
    </div>
  </div>

</main>

{% endblock %}

{% block js %}
{% load static %}
<script src="{% static 'model.js' %}"></script>
{% endblock %}
